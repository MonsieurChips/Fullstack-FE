<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StudyZone - Our Lessons</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome CDN (Still needed for buttons) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="assets/css/styles.css" />
  </head>
  <body class="bg-gray-100">
    <div id="app" class="antialiased text-gray-800">
      <!-- Header -->
      <header class="bg-white shadow-md sticky top-0 z-20">
        <nav
          class="container mx-auto px-6 py-4 flex justify-between items-center"
        >
          <a href="index.html" class="flex items-center space-x-3">
            <!-- Corrected "S" Flame SVG Logo -->
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM14.08 17.35C13.24 17.76 12.28 18 11.25 18C8.9 18 7 16.1 7 13.75C7 11.4 8.9 9.5 11.25 9.5C12.28 9.5 13.24 9.74 14.08 10.15L13.22 11.45C12.66 11.15 11.99 11 11.25 11C9.73 11 8.5 12.23 8.5 13.75C8.5 15.27 9.73 16.5 11.25 16.5C11.99 16.5 12.66 16.35 13.22 16.05L14.08 17.35Z"
                fill="#4338CA"
              />
              <path
                d="M15.5 12C15.5 10.62 14.38 9.5 13 9.5C12.72 9.5 12.45 9.55 12.2 9.66L15.34 12.8L15.5 12Z"
                fill="#6366F1"
              />
            </svg>
            <h1 class="text-2xl font-bold text-gray-800">StudyZone</h1>
          </a>
          <a
            href="cart.html"
            class="relative flex items-center px-4 py-2 rounded-md bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition duration-300"
          >
            <i class="fas fa-shopping-cart mr-2"></i>
            <span>Shopping Cart</span>
            <span
              v-if="cartItemCount > 0"
              class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center"
            >
              {{ cartItemCount }}
            </span>
          </a>
        </nav>
      </header>

      <main class="container mx-auto p-4 md:p-8">
        <div
          v-if="orderSuccess"
          class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded-md"
          role="alert"
        >
          <p class="font-bold">Success!</p>
          <p>
            Your order has been placed successfully. Thank you for your
            purchase!
          </p>
        </div>

        <div v-if="loading" class="flex justify-center items-center h-64">
          <div class="spinner"></div>
        </div>

        <div
          v-if="error"
          class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6"
          role="alert"
        >
          <strong class="font-bold">Error:</strong>
          <span class="block sm:inline">{{ error }}</span>
        </div>

        <div v-if="!loading">
          <div
            class="bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-col md:flex-row gap-4 justify-between items-center"
          >
            <div class="relative w-full md:w-1/3">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-search text-gray-400"></i>
              </span>
              <input
                v-model="searchQuery"
                @input="handleSearch"
                type="text"
                placeholder="Search for lessons..."
                class="w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
              />
            </div>

            <div class="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
              <div class="flex items-center space-x-2">
                <label for="sort-by" class="font-semibold">Sort by:</label>
                <select
                  v-model="sort.attribute"
                  id="sort-by"
                  class="border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                >
                  <option value="name">Subject</option>
                  <option value="location">Location</option>
                  <option value="price">Price</option>
                  <option value="availableSpaces">Availability</option>
                </select>
              </div>
              <div class="flex items-center space-x-2">
                <label for="sort-order" class="font-semibold">Order:</label>
                <select
                  v-model="sort.order"
                  id="sort-order"
                  class="border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                >
                  <option value="asc">Ascending</option>
                  <option value="desc">Descending</option>
                </select>
              </div>
            </div>
          </div>

          <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
          >
            <div
              v-for="lesson in sortedLessons"
              :key="lesson._id"
              class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col"
            >
              <a
                :href="'lesson.html?id=' + lesson._id"
                class="block h-48 w-full bg-gray-200 group"
              >
                <img
                  :src="lesson.image"
                  :alt="lesson.name"
                  class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-300"
                  onerror="this.onerror=null;this.src='https://placehold.co/600x400/EEE/31343C?text=Image+Not+Found';"
                />
              </a>

              <div class="p-4 flex-grow">
                <a :href="'lesson.html?id=' + lesson._id" class="block">
                  <h3
                    class="text-xl font-bold mb-2 hover:text-indigo-600 transition-colors"
                  >
                    {{ lesson.name }}
                  </h3>
                </a>
                <p class="text-gray-600 mb-1">
                  <i class="fas fa-map-marker-alt w-5"></i> {{ lesson.location
                  }}
                </p>
                <p class="text-gray-600 mb-1">
                  <i class="fas fa-layer-group w-5"></i> {{ lesson.category }}
                </p>
                <p class="text-lg font-semibold text-indigo-600 my-2">
                  <i class="fas fa-tag w-5"></i> Â£{{ lesson.price }}
                </p>
                <p class="text-gray-600 text-sm">{{ lesson.description }}</p>
              </div>
              <div class="p-4 bg-gray-50">
                <p
                  class="text-sm font-semibold mb-3 text-center"
                  :class="lesson.displaySpaces > 0 ? 'text-green-600' : 'text-red-600'"
                >
                  {{ lesson.displaySpaces }} in stock
                </p>
                <button
                  @click="addToCart(lesson)"
                  :disabled="!canAddToCart(lesson)"
                  :class="{'disabled-btn': !canAddToCart(lesson)}"
                  class="w-full py-2 px-4 rounded-md bg-green-500 text-white font-semibold hover:bg-green-600 transition duration-300 disabled:bg-gray-400"
                >
                  <i class="fas fa-cart-plus mr-2"></i>
                  Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="assets/js/app.js"></script>
  </body>
</html>
